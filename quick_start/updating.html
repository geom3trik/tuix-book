<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Making the Counter Reusable - Tuix Guide</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Overview</a></li><li class="chapter-item expanded affix "><li class="part-title">Quick Start Guide</li><li class="chapter-item expanded "><a href="../quick_start/intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../quick_start/creating_an_application.html"><strong aria-hidden="true">2.</strong> Creating an Application</a></li><li class="chapter-item expanded "><a href="../quick_start/setting_window_properties.html"><strong aria-hidden="true">3.</strong> Setting Window Properties</a></li><li class="chapter-item expanded "><a href="../quick_start/adding_a_widget.html"><strong aria-hidden="true">4.</strong> Adding a Button</a></li><li class="chapter-item expanded "><a href="../quick_start/positioning_the_widget.html"><strong aria-hidden="true">5.</strong> Positioning the Button</a></li><li class="chapter-item expanded "><a href="../quick_start/composing_widgets.html"><strong aria-hidden="true">6.</strong> Composing Widgets</a></li><li class="chapter-item expanded "><a href="../quick_start/widget_styling.html"><strong aria-hidden="true">7.</strong> Styling the App</a></li><li class="chapter-item expanded "><a href="../quick_start/custom_widget.html"><strong aria-hidden="true">8.</strong> Creating a Counter Widget</a></li><li class="chapter-item expanded "><a href="../quick_start/handling_events.html"><strong aria-hidden="true">9.</strong> Handling Events</a></li><li class="chapter-item expanded "><a href="../quick_start/reactivity_and_binding.html"><strong aria-hidden="true">10.</strong> Reactivity and Model Data</a></li><li class="chapter-item expanded "><a href="../quick_start/lenses_and_binding.html"><strong aria-hidden="true">11.</strong> Lenses and Binding</a></li><li class="chapter-item expanded "><a href="../quick_start/updating.html" class="active"><strong aria-hidden="true">12.</strong> Making the Counter Reusable</a></li><li class="chapter-item expanded affix "><li class="part-title">Layout</li><li class="chapter-item expanded "><a href="../layout/stack_overview.html"><strong aria-hidden="true">13.</strong> Overview (Stack)</a></li><li class="chapter-item expanded "><a href="../layout/child_properties.html"><strong aria-hidden="true">14.</strong> Child Properies</a></li><li class="chapter-item expanded "><a href="../layout/parent_properties.html"><strong aria-hidden="true">15.</strong> Parent Properies</a></li><li class="chapter-item expanded "><a href="../layout/grid_overview.html"><strong aria-hidden="true">16.</strong> Overview (Grid)</a></li><li class="chapter-item expanded "><a href="../layout/stacks.html"><strong aria-hidden="true">17.</strong> Stacks</a></li><li class="chapter-item expanded "><a href="../layout/positioning_text.html"><strong aria-hidden="true">18.</strong> Positioning Text</a></li><li class="chapter-item expanded "><a href="../layout/layout_properties.html"><strong aria-hidden="true">19.</strong> Layout Properties</a></li><li class="chapter-item expanded affix "><li class="part-title">Events</li><li class="chapter-item expanded "><a href="../events/chapter_1.html"><strong aria-hidden="true">20.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../events/events_and_messages.html"><strong aria-hidden="true">21.</strong> Events and Messages</a></li><li class="chapter-item expanded "><a href="../events/event_propagation.html"><strong aria-hidden="true">22.</strong> Event Propagation</a></li><li class="chapter-item expanded "><a href="../events/handling_events.html"><strong aria-hidden="true">23.</strong> Handling Events</a></li><li class="chapter-item expanded "><a href="../events/window_events.html"><strong aria-hidden="true">24.</strong> Window Events</a></li><li class="chapter-item expanded affix "><li class="part-title">Styling</li><li class="chapter-item expanded "><a href="../styling/overview.html"><strong aria-hidden="true">25.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../styling/inline_styling.html"><strong aria-hidden="true">26.</strong> Inline Styling</a></li><li class="chapter-item expanded "><a href="../styling/shared_styling.html"><strong aria-hidden="true">27.</strong> Shared Styling</a></li><li class="chapter-item expanded "><a href="../styling/style_properties.html"><strong aria-hidden="true">28.</strong> Style Properties</a></li><li class="chapter-item expanded "><a href="../styling/selectors.html"><strong aria-hidden="true">29.</strong> Selectors</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../styling/display.html"><strong aria-hidden="true">29.1.</strong> Display</a></li><li class="chapter-item expanded "><a href="../styling/background.html"><strong aria-hidden="true">29.2.</strong> Background</a></li><li class="chapter-item expanded "><a href="../styling/border.html"><strong aria-hidden="true">29.3.</strong> Border</a></li><li class="chapter-item expanded "><a href="../styling/shadows.html"><strong aria-hidden="true">29.4.</strong> Shadows</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Bindng</li><li class="chapter-item expanded "><a href="../binding/intro.html"><strong aria-hidden="true">30.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../binding/model.html"><strong aria-hidden="true">31.</strong> Model</a></li><li class="chapter-item expanded "><a href="../binding/lens.html"><strong aria-hidden="true">32.</strong> Lens</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Tuix Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="making-the-counter-reusable"><a class="header" href="#making-the-counter-reusable">Making the Counter Reusable</a></h1>
<p>Okay so we've got a reactive counter. It's reactive because when the value changes, via a button press, both labels update to show the new value without us having to explicitely send events to them.</p>
<p>However, with the way we've done it, our counter widget can't be used in another application unless it too has the same <code>CounterState</code> application data. We need to make our counter more generic.</p>
<p>When using our <code>Counter</code> widget in an app we won't have access to the label as it's built into the widget. So instead of binding to the label, we need to be able to bind to the counter widget itself.</p>
<h2 id="the-data-associated-type"><a class="header" href="#the-data-associated-type">The Data Associated Type</a></h2>
<p>This is where the <code>Data</code> associated type comes in from the <code>Widget</code> trait, which we previously set to <code>()</code>. This associated type is used to specify the type of data a widget is expected to receive. It was mentioned before that a <code>Label</code> expects a <code>String</code>, which is because its associated data type is <code>type Data = String</code>.</p>
<p>Let's modify our counter to remove the <code>bind</code> method on the <code>Label</code> within the <code>Counter</code> widet, and change the data associated type to <code>type Data = i32</code>. </p>
<h2 id="on-update"><a class="header" href="#on-update">On Update</a></h2>
<p>For actually updating the counter we'll use the <code>on_update</code> method provided by the <code>Widget</code> trait. Add the following code to the implementation of <code>Widget</code> for our <code>Counter</code> below the <code>on_update</code> method:</p>
<pre><code class="language-rs">fn on_update(&amp;mut self, state: &amp;mut State, entity: Entity, data: &amp;Self::Data) {
    self.label.set_text(state, &amp;data.to_string());
}
</code></pre>
<p>As with the <code>on_build</code> and <code>on_event</code> methods, the first three arguments are the same: a mutable reference to <code>Self</code> so internal widget data can be modified, and a mutable reference to <code>State</code> followed by an <code>Entity</code> id, for modifying style and layout properties as well as for sending events.</p>
<p>In this case we use the internal <code>label</code> field (which is the entity id of label) to set its text to the <code>data</code> value (converted from <code>i32</code> to a string) received when our counter widget is updated.</p>
<p>The last step is to add a call to <code>bind()</code> on the counter widget. Change the building of the counter widget to the following:</p>
<pre><code class="language-rs">Counter::default()
    .bind(CounterState::value, |value: &amp;i32| *value)
    .build(state, app_data, |builder| builder);
</code></pre>
<p>We pass the same lens as before to the value of the <code>CounterState</code> and the conversion closure converts the reference to the value into a copy.</p>
<p>So how does this work? </p>
<ol>
<li>Building the <code>Model</code> created a <code>Store</code>, which itself is a widget which contains the application data as well as a list of observer widgets (using entity ids).</li>
<li>The <code>bind</code> method sends an event to the store which registers the widget as an oberver.</li>
<li>Pressing a button sends an event up the tree to the store, which then mutates the data in response.</li>
<li>The store then calls the <code>on_update</code> method of all bound widgets, passing the new updated value.</li>
</ol>
<p>And we're done!</p>
<p>When we build and run our app now we get the same behaviour as before but our counter widget is now re-usable! We could now add this counter widget into any application, and we just need to bind it to a piece of data, using the conversion closure to convert that data in some way to an <code>i32</code>. The label would then display the value. The only other part required is to respond to <code>CounterEvent</code> messages emited by the counter's buttons.</p>
<p>The full code for this reactive counter can be found in the <code>/examples/counter_reactive.rs</code> file in the tuix repository and can be run with <code>cargo run --release --example counter_reactive</code>.</p>
<h1 id="conclusion"><a class="header" href="#conclusion">Conclusion</a></h1>
<p>This concludes the tuix 'quick' guide! If you made it this far, thanks for reading! The rest of this book attempts to cover the concepts shown in this guide in more detail, demonstrating what features are available and how they can be used to build complex user interfaces.</p>
<h2 id="coming-soon"><a class="header" href="#coming-soon">Coming Soon...</a></h2>
<p>Coming soon will be an 'advanced' guide in which a todo app will be created with more advanced features such as:</p>
<ul>
<li>Binding to lists of items</li>
<li>'Local' app data for syncing widgets in a sub-section of the tree</li>
<li>Animations (almost all style and layout properties are animatable)</li>
<li>Using more complex built-in widgets</li>
<li>Constructing more complex custom widgets</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../quick_start/lenses_and_binding.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../layout/stack_overview.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../quick_start/lenses_and_binding.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../layout/stack_overview.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
