<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Lenses and Binding - Tuix Guide</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Overview</a></li><li class="chapter-item expanded affix "><li class="part-title">Quick Start Guide</li><li class="chapter-item expanded "><a href="../quick_start/intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../quick_start/creating_an_application.html"><strong aria-hidden="true">2.</strong> Creating an Application</a></li><li class="chapter-item expanded "><a href="../quick_start/setting_window_properties.html"><strong aria-hidden="true">3.</strong> Setting Window Properties</a></li><li class="chapter-item expanded "><a href="../quick_start/adding_a_widget.html"><strong aria-hidden="true">4.</strong> Adding a Button</a></li><li class="chapter-item expanded "><a href="../quick_start/positioning_the_widget.html"><strong aria-hidden="true">5.</strong> Positioning the Button</a></li><li class="chapter-item expanded "><a href="../quick_start/composing_widgets.html"><strong aria-hidden="true">6.</strong> Composing Widgets</a></li><li class="chapter-item expanded "><a href="../quick_start/widget_styling.html"><strong aria-hidden="true">7.</strong> Styling the App</a></li><li class="chapter-item expanded "><a href="../quick_start/custom_widget.html"><strong aria-hidden="true">8.</strong> Creating a Counter Widget</a></li><li class="chapter-item expanded "><a href="../quick_start/handling_events.html"><strong aria-hidden="true">9.</strong> Handling Events</a></li><li class="chapter-item expanded "><a href="../quick_start/reactivity_and_binding.html"><strong aria-hidden="true">10.</strong> Reactivity and Model Data</a></li><li class="chapter-item expanded "><a href="../quick_start/lenses_and_binding.html" class="active"><strong aria-hidden="true">11.</strong> Lenses and Binding</a></li><li class="chapter-item expanded "><a href="../quick_start/updating.html"><strong aria-hidden="true">12.</strong> Making the Counter Reusable</a></li><li class="chapter-item expanded affix "><li class="part-title">Building</li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.</strong> Building Widgets</div></li><li class="chapter-item expanded affix "><li class="part-title">Layout</li><li class="chapter-item expanded "><a href="../layout/stack_overview.html"><strong aria-hidden="true">14.</strong> Overview (Stack)</a></li><li class="chapter-item expanded "><a href="../layout/child_properties.html"><strong aria-hidden="true">15.</strong> Child Properies</a></li><li class="chapter-item expanded "><a href="../layout/parent_properties.html"><strong aria-hidden="true">16.</strong> Parent Properies</a></li><li class="chapter-item expanded "><a href="../layout/grid_overview.html"><strong aria-hidden="true">17.</strong> Overview (Grid)</a></li><li class="chapter-item expanded "><a href="../layout/stacks.html"><strong aria-hidden="true">18.</strong> Stacks</a></li><li class="chapter-item expanded "><a href="../layout/positioning_text.html"><strong aria-hidden="true">19.</strong> Positioning Text</a></li><li class="chapter-item expanded "><a href="../layout/layout_properties.html"><strong aria-hidden="true">20.</strong> Layout Properties</a></li><li class="chapter-item expanded affix "><li class="part-title">Styling</li><li class="chapter-item expanded "><a href="../styling/overview.html"><strong aria-hidden="true">21.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../styling/inline_styling.html"><strong aria-hidden="true">22.</strong> Inline Styling</a></li><li class="chapter-item expanded "><a href="../styling/shared_styling.html"><strong aria-hidden="true">23.</strong> Shared Styling</a></li><li class="chapter-item expanded "><a href="../styling/selectors.html"><strong aria-hidden="true">24.</strong> Selectors</a></li><li class="chapter-item expanded "><a href="../styling/style_properties.html"><strong aria-hidden="true">25.</strong> Style Properties</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../styling/display.html"><strong aria-hidden="true">25.1.</strong> Display</a></li><li class="chapter-item expanded "><a href="../styling/background.html"><strong aria-hidden="true">25.2.</strong> Background</a></li><li class="chapter-item expanded "><a href="../styling/border.html"><strong aria-hidden="true">25.3.</strong> Border</a></li><li class="chapter-item expanded "><a href="../styling/shadows.html"><strong aria-hidden="true">25.4.</strong> Shadows</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Events</li><li class="chapter-item expanded "><a href="../events/chapter_1.html"><strong aria-hidden="true">26.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../events/events_and_messages.html"><strong aria-hidden="true">27.</strong> Events and Messages</a></li><li class="chapter-item expanded "><a href="../events/event_propagation.html"><strong aria-hidden="true">28.</strong> Event Propagation</a></li><li class="chapter-item expanded "><a href="../events/handling_events.html"><strong aria-hidden="true">29.</strong> Handling Events</a></li><li class="chapter-item expanded "><a href="../events/window_events.html"><strong aria-hidden="true">30.</strong> Window Events</a></li><li class="chapter-item expanded affix "><li class="part-title">Binding and Reactivity</li><li class="chapter-item expanded "><a href="../binding/intro.html"><strong aria-hidden="true">31.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../binding/model.html"><strong aria-hidden="true">32.</strong> Model</a></li><li class="chapter-item expanded "><a href="../binding/lens.html"><strong aria-hidden="true">33.</strong> Lens</a></li><li class="chapter-item expanded affix "><li class="part-title">Widget Reference</li><li class="chapter-item expanded "><a href="../widgets/buttons.html"><strong aria-hidden="true">34.</strong> Buttons</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../widgets/buttons/button.html"><strong aria-hidden="true">34.1.</strong> Button</a></li><li class="chapter-item expanded "><a href="../widgets/buttons/check_button.html"><strong aria-hidden="true">34.2.</strong> CheckButton</a></li><li class="chapter-item expanded "><a href="../widgets/buttons/checkbox.html"><strong aria-hidden="true">34.3.</strong> Checkbox</a></li><li class="chapter-item expanded "><a href="../widgets/buttons/radio.html"><strong aria-hidden="true">34.4.</strong> Radio</a></li><li class="chapter-item expanded "><a href="../widgets/buttons/switch.html"><strong aria-hidden="true">34.5.</strong> Switch</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Tuix Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="lenses-and-binding"><a class="header" href="#lenses-and-binding">Lenses and Binding</a></h1>
<p>In the previous section we built some application data near the root of our gui app, but pressing the counter buttons still displays the internal value of our counter widget. </p>
<p>Let's remove the <code>on_event</code> of the <code>Counter</code> and the <code>value</code> field as well. Now the counter contains no count value, so we need to hook it up to the app data count value instead. </p>
<p>First, modify the declaration of the <code>CounterState</code> struct to add the <code>Lens</code> derive macro like so:</p>
<pre><code class="language-rs">#[derive(Default, Lens)]
struct CounterState {
    value: i32,
}
</code></pre>
<p>We'll go over lenses and what the <code>Lens</code> derive macro is doing in more detail in a moment, but let's take a look at binding our label to the counter value.</p>
<h2 id="binding"><a class="header" href="#binding">Binding</a></h2>
<p>With the <code>Lens</code> derive we can now bind the label in our counter to the value in the counter state with the <code>bind</code> method. Change the label to the following:</p>
<pre><code class="language-rs">self.label = Label::new(&quot;0&quot;)
    .bind(CounterState::value, |value| value.to_string())
    .build(state, row, |builder| 
        builder
            .set_width(Pixels(100.0))
            .set_height(Pixels(30.0))
    );
</code></pre>
<p>Let's break down what's going on here. The <code>bind</code> method is placed between the creation of the label instance and the call to <code>build</code>. It has two arguments, a lens and a closure:</p>
<ol>
<li>
<p>The first argument is a lens. We'll cover it in a moment but for now you can think of it as something which 'selects' a piece of a larger structure, in this case the <code>value</code> field of the <code>CounterState</code> struct.</p>
</li>
<li>
<p>The second argument is a closure which acts as a converter for the lensed data. The counter value is an <code>i32</code> but the label expects a <code>String</code>, so we use the <code>.to_string()</code> method to convert the value to the expected type.</p>
</li>
</ol>
<h2 id="lenses"><a class="header" href="#lenses">Lenses</a></h2>
<p>At first glance the lens argument of the <code>bind()</code> method seems a bit magical. How are we accessing the value with <code>CounterState::value</code>? That doesn't seem like valid rust code. There's a few things going on here which are hidden by the <code>Lens</code> derive macro, so let's break it down. </p>
<p>A lens, at its core, is nothing more than a function which takes some data as input and returns a piece of that data as output, usually as references. In this case it would take an reference to some <code>CounterState</code> and return a reference to the <code>value</code>. This function is actually a method on a <code>Lens</code> trait, which looks something like this:</p>
<pre><code class="language-rs">pub trait Lens {
    type Source;
    type Target;

    fn view&lt;'a&gt;(&amp;self, data: &amp;'a Self::Source) -&gt; &amp;'a Self::Target;
}
</code></pre>
<p>The derive macro creates for us a zero-sized static type and then implements this <code>Lens</code> trait on it, which might look something like this:</p>
<pre><code class="language-rs">pub struct SomeGeneratedType;

impl Lens for SomeGeneratedType {
    type Source = CounterState;
    type Target = i32;

    fn view&lt;'a&gt;(&amp;self, data: &amp;'a AppData) -&gt; &amp;'a i32 {
        &amp;data.value
    }
}
</code></pre>
<p>The other thing that the derive macro does is to create a static instance of the generated type, with the same name as the field (<code>value</code>), within a module called <code>CounterState</code>. This is what allows us to use <code>CounterState::value</code> to refer to the lens.</p>
<h2 id="binding-another-label"><a class="header" href="#binding-another-label">Binding Another Label</a></h2>
<p>Now when we run the code we seemingly get the same counter behavior as before. The buttons update the value, via events, and the label receives the new value and updates its display. So why did we do this? Well, now we can do something more interesting, like bind another widget to the same value and display it in a different way, like printing the value as english text. Add the following dependency to the <code>Cargo.toml</code> file:</p>
<pre><code class="language-sh">english-numbers = &quot;0.3.3&quot;
</code></pre>
<p>Then add a label to the application below the counter with the following <code>bind</code> method:</p>
<pre><code class="language-rs">Label::new(&quot;Zero&quot;)
    .bind(CounterState::value, |value| english_numbers::convert_all_fmt(*value as i64))
    .build(state, data_widget, |builder| 
        builder
            .set_space(Pixels(5.0))
    );
</code></pre>
<p>We bind the label to the same value and use the conversion closure to call a method from the <code>english_numbers</code> crate to convert the value to an english word. Now when the buttons are pressed to increment and decrement the counter, both labels update to show the value in two different ways!</p>
<p align="center"><img src="../images/quick_guide/counter_reactive.png" alt="tuix app"></p>
<p>In the next section we'll look at how we can make our counter widget more re-usable.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../quick_start/reactivity_and_binding.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../quick_start/updating.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../quick_start/reactivity_and_binding.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../quick_start/updating.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
