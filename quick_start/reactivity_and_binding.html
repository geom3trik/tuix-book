<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Reactivity and Model Data - Tuix Guide</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Overview</a></li><li class="chapter-item expanded affix "><li class="part-title">Quick Start Guide</li><li class="chapter-item expanded "><a href="../quick_start/intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../quick_start/creating_an_application.html"><strong aria-hidden="true">2.</strong> Creating an Application</a></li><li class="chapter-item expanded "><a href="../quick_start/setting_window_properties.html"><strong aria-hidden="true">3.</strong> Setting Window Properties</a></li><li class="chapter-item expanded "><a href="../quick_start/adding_a_widget.html"><strong aria-hidden="true">4.</strong> Adding a Button</a></li><li class="chapter-item expanded "><a href="../quick_start/positioning_the_widget.html"><strong aria-hidden="true">5.</strong> Positioning the Button</a></li><li class="chapter-item expanded "><a href="../quick_start/composing_widgets.html"><strong aria-hidden="true">6.</strong> Composing Widgets</a></li><li class="chapter-item expanded "><a href="../quick_start/widget_styling.html"><strong aria-hidden="true">7.</strong> Styling the App</a></li><li class="chapter-item expanded "><a href="../quick_start/custom_widget.html"><strong aria-hidden="true">8.</strong> Creating a Counter Widget</a></li><li class="chapter-item expanded "><a href="../quick_start/handling_events.html"><strong aria-hidden="true">9.</strong> Handling Events</a></li><li class="chapter-item expanded "><a href="../quick_start/reactivity_and_binding.html" class="active"><strong aria-hidden="true">10.</strong> Reactivity and Model Data</a></li><li class="chapter-item expanded "><a href="../quick_start/lenses_and_binding.html"><strong aria-hidden="true">11.</strong> Lenses and Binding</a></li><li class="chapter-item expanded "><a href="../quick_start/updating.html"><strong aria-hidden="true">12.</strong> Making the Counter Reusable</a></li><li class="chapter-item expanded affix "><li class="part-title">Building</li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.</strong> Building Widgets</div></li><li class="chapter-item expanded affix "><li class="part-title">Layout</li><li class="chapter-item expanded "><a href="../layout/stack_overview.html"><strong aria-hidden="true">14.</strong> Overview (Stack)</a></li><li class="chapter-item expanded "><a href="../layout/child_properties.html"><strong aria-hidden="true">15.</strong> Child Properies</a></li><li class="chapter-item expanded "><a href="../layout/parent_properties.html"><strong aria-hidden="true">16.</strong> Parent Properies</a></li><li class="chapter-item expanded "><a href="../layout/grid_overview.html"><strong aria-hidden="true">17.</strong> Overview (Grid)</a></li><li class="chapter-item expanded "><a href="../layout/stacks.html"><strong aria-hidden="true">18.</strong> Stacks</a></li><li class="chapter-item expanded "><a href="../layout/positioning_text.html"><strong aria-hidden="true">19.</strong> Positioning Text</a></li><li class="chapter-item expanded "><a href="../layout/layout_properties.html"><strong aria-hidden="true">20.</strong> Layout Properties</a></li><li class="chapter-item expanded affix "><li class="part-title">Styling</li><li class="chapter-item expanded "><a href="../styling/overview.html"><strong aria-hidden="true">21.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../styling/inline_styling.html"><strong aria-hidden="true">22.</strong> Inline Styling</a></li><li class="chapter-item expanded "><a href="../styling/shared_styling.html"><strong aria-hidden="true">23.</strong> Shared Styling</a></li><li class="chapter-item expanded "><a href="../styling/selectors.html"><strong aria-hidden="true">24.</strong> Selectors</a></li><li class="chapter-item expanded "><a href="../styling/style_properties.html"><strong aria-hidden="true">25.</strong> Style Properties</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../styling/display.html"><strong aria-hidden="true">25.1.</strong> Display</a></li><li class="chapter-item expanded "><a href="../styling/background.html"><strong aria-hidden="true">25.2.</strong> Background</a></li><li class="chapter-item expanded "><a href="../styling/border.html"><strong aria-hidden="true">25.3.</strong> Border</a></li><li class="chapter-item expanded "><a href="../styling/shadows.html"><strong aria-hidden="true">25.4.</strong> Shadows</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Events</li><li class="chapter-item expanded "><a href="../events/chapter_1.html"><strong aria-hidden="true">26.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../events/events_and_messages.html"><strong aria-hidden="true">27.</strong> Events and Messages</a></li><li class="chapter-item expanded "><a href="../events/event_propagation.html"><strong aria-hidden="true">28.</strong> Event Propagation</a></li><li class="chapter-item expanded "><a href="../events/handling_events.html"><strong aria-hidden="true">29.</strong> Handling Events</a></li><li class="chapter-item expanded "><a href="../events/window_events.html"><strong aria-hidden="true">30.</strong> Window Events</a></li><li class="chapter-item expanded affix "><li class="part-title">Binding and Reactivity</li><li class="chapter-item expanded "><a href="../binding/intro.html"><strong aria-hidden="true">31.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../binding/model.html"><strong aria-hidden="true">32.</strong> Model</a></li><li class="chapter-item expanded "><a href="../binding/lens.html"><strong aria-hidden="true">33.</strong> Lens</a></li><li class="chapter-item expanded affix "><li class="part-title">Widget Reference</li><li class="chapter-item expanded "><a href="../widgets/buttons.html"><strong aria-hidden="true">34.</strong> Buttons</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../widgets/buttons/button.html"><strong aria-hidden="true">34.1.</strong> Button</a></li><li class="chapter-item expanded "><a href="../widgets/buttons/check_button.html"><strong aria-hidden="true">34.2.</strong> CheckButton</a></li><li class="chapter-item expanded "><a href="../widgets/buttons/checkbox.html"><strong aria-hidden="true">34.3.</strong> Checkbox</a></li><li class="chapter-item expanded "><a href="../widgets/buttons/radio.html"><strong aria-hidden="true">34.4.</strong> Radio</a></li><li class="chapter-item expanded "><a href="../widgets/buttons/switch.html"><strong aria-hidden="true">34.5.</strong> Switch</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Tuix Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="reactivity-and-model-data"><a class="header" href="#reactivity-and-model-data">Reactivity and Model Data</a></h1>
<p>In the previous sections we built a simple counter widget. This widget could now be embedded into a more complex gui and work just fine, keeping its own count. However, this isn't always the most practical solution. What if we had two counters and we wanted them to be synced to the same value? Okay we could send some events from one to the other but this isn't always so easy, especially if the widgets are 'far' away from each other within the tree.</p>
<p>The example of two counters being synced is a bit contrived but the issue of sharing application data between widgets is important and leads to reactivity as the solution. What is reactivity? For tuix, reactivity is the ability for widgets to 'bind' to application data, so that when the data changes, all the bound widgets update their state automatically. It's this ability which allows for more scalable applications.</p>
<p>In this section and the next we will modify our counter by adding another separate label, and syncing both our counter and the label to some shared data. </p>
<h2 id="model-data"><a class="header" href="#model-data">Model Data</a></h2>
<p>We'll start with the counter example as we left it in the previous section. </p>
<p>First we need to add a struct for the shared application data:</p>
<pre><code class="language-rs">#[derive(Default)]
struct CounterState {
    value: i32
}
</code></pre>
<p>Just like the counter widget before, this struct contains an <code>i32</code> value to represent the count.</p>
<p>To allow this data to be embedded within the gui tree we need to implement the <code>Model</code> trait for it:</p>
<pre><code class="language-rs">impl Model for CounterState {

}
</code></pre>
<p>The <code>Model</code> trait is similar to the <code>Widget</code> trait but is used for non-visual data. It also contains an <code>on_event</code> method to respond to events, and allows us to <code>build</code> the data into the tree. </p>
<p>Modify the implementation of <code>Model</code> on <code>CounterState</code> so that it updates the value in response to a <code>CounterEvent</code> within the <code>on_event</code> method, just like we did for our custom counter widget before:</p>
<pre><code class="language-rs">impl Model for CounterState {
    fn on_event(&amp;mut self, state: &amp;mut State, entity: Entity, event: &amp;mut Event) {
        if let Some(counter_event) = event.message.downcast() {
            match counter_event {
                CounterEvent::Increment =&gt; {
                    self.value += 1;
                    entity.emit(state, BindEvent::Update);
                }

                CounterEvent::Decrement =&gt; {
                    self.value -= 1;
                    entity.emit(state, BindEvent::Update);
                }
            }
        }        
    }
}
</code></pre>
<p>Note the call to emit a <code>BindEvent::Update</code> event at each point the value is changed. Tuix does not (yet) provide a built-in method to detect changes of application data, so this event must be sent manually so bound widgets so they receive an update.</p>
<h3 id="building-model-data"><a class="header" href="#building-model-data">Building Model Data</a></h3>
<p>Now that we have our application data in a separate struct we need to build it into the app. Insert this code into the application closure above the call to create and build the counter widget:</p>
<pre><code class="language-rs">let app_data = CounterState::default().build(state, window);
</code></pre>
<p>Note that the <code>build</code> function on <code>CounterState</code> does not contain a builder closure because this isn't a visual widget.</p>
<p>Next, make sure to change the parent of the counter to the application data:</p>
<pre><code class="language-rs">Counter::default().build(state, app_data, |builder| builder);
</code></pre>
<p>We have now inserted the app data just below the root of the application (the window) but above everything else. This means that any events that are sent up from widgets in the app will make their way to the app data thanks to it being an ancestor of everything below it. </p>
<p>Pressing the buttons of the counter will now modify the app data, but the label is still showing the internal value of the <code>Counter</code>. In the next section we'll modify our counter to remove the internal value and hook it up to our shared app data.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../quick_start/handling_events.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../quick_start/lenses_and_binding.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../quick_start/handling_events.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../quick_start/lenses_and_binding.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
