<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Handling Events - Tuix Guide</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../introduction.html">Overview</a></li><li class="chapter-item expanded affix "><li class="part-title">Quick Start Guide</li><li class="chapter-item expanded "><a href="../quick_start/intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../quick_start/creating_an_application.html"><strong aria-hidden="true">2.</strong> Creating an Application</a></li><li class="chapter-item expanded "><a href="../quick_start/setting_window_properties.html"><strong aria-hidden="true">3.</strong> Setting Window Properties</a></li><li class="chapter-item expanded "><a href="../quick_start/adding_a_widget.html"><strong aria-hidden="true">4.</strong> Adding a Button</a></li><li class="chapter-item expanded "><a href="../quick_start/positioning_the_widget.html"><strong aria-hidden="true">5.</strong> Positioning the Button</a></li><li class="chapter-item expanded "><a href="../quick_start/composing_widgets.html"><strong aria-hidden="true">6.</strong> Composing Widgets</a></li><li class="chapter-item expanded "><a href="../quick_start/widget_styling.html"><strong aria-hidden="true">7.</strong> Styling the App</a></li><li class="chapter-item expanded "><a href="../quick_start/custom_widget.html"><strong aria-hidden="true">8.</strong> Creating a Counter Widget</a></li><li class="chapter-item expanded "><a href="../quick_start/handling_events.html" class="active"><strong aria-hidden="true">9.</strong> Handling Events</a></li><li class="chapter-item expanded "><a href="../quick_start/reactivity_and_binding.html"><strong aria-hidden="true">10.</strong> Reactivity and Model Data</a></li><li class="chapter-item expanded "><a href="../quick_start/lenses_and_binding.html"><strong aria-hidden="true">11.</strong> Lenses and Binding</a></li><li class="chapter-item expanded "><a href="../quick_start/updating.html"><strong aria-hidden="true">12.</strong> Making the Counter Reusable</a></li><li class="chapter-item expanded affix "><li class="part-title">Building</li><li class="chapter-item expanded "><div><strong aria-hidden="true">13.</strong> Building Widgets</div></li><li class="chapter-item expanded affix "><li class="part-title">Layout</li><li class="chapter-item expanded "><a href="../layout/stack_overview.html"><strong aria-hidden="true">14.</strong> Overview (Stack)</a></li><li class="chapter-item expanded "><a href="../layout/child_properties.html"><strong aria-hidden="true">15.</strong> Child Properies</a></li><li class="chapter-item expanded "><a href="../layout/parent_properties.html"><strong aria-hidden="true">16.</strong> Parent Properies</a></li><li class="chapter-item expanded "><a href="../layout/grid_overview.html"><strong aria-hidden="true">17.</strong> Overview (Grid)</a></li><li class="chapter-item expanded "><a href="../layout/stacks.html"><strong aria-hidden="true">18.</strong> Stacks</a></li><li class="chapter-item expanded "><a href="../layout/positioning_text.html"><strong aria-hidden="true">19.</strong> Positioning Text</a></li><li class="chapter-item expanded "><a href="../layout/layout_properties.html"><strong aria-hidden="true">20.</strong> Layout Properties</a></li><li class="chapter-item expanded affix "><li class="part-title">Styling</li><li class="chapter-item expanded "><a href="../styling/overview.html"><strong aria-hidden="true">21.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../styling/inline_styling.html"><strong aria-hidden="true">22.</strong> Inline Styling</a></li><li class="chapter-item expanded "><a href="../styling/shared_styling.html"><strong aria-hidden="true">23.</strong> Shared Styling</a></li><li class="chapter-item expanded "><a href="../styling/selectors.html"><strong aria-hidden="true">24.</strong> Selectors</a></li><li class="chapter-item expanded "><a href="../styling/style_properties.html"><strong aria-hidden="true">25.</strong> Style Properties</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../styling/display.html"><strong aria-hidden="true">25.1.</strong> Display</a></li><li class="chapter-item expanded "><a href="../styling/background.html"><strong aria-hidden="true">25.2.</strong> Background</a></li><li class="chapter-item expanded "><a href="../styling/border.html"><strong aria-hidden="true">25.3.</strong> Border</a></li><li class="chapter-item expanded "><a href="../styling/shadows.html"><strong aria-hidden="true">25.4.</strong> Shadows</a></li></ol></li><li class="chapter-item expanded "><li class="part-title">Events</li><li class="chapter-item expanded "><a href="../events/chapter_1.html"><strong aria-hidden="true">26.</strong> Overview</a></li><li class="chapter-item expanded "><a href="../events/events_and_messages.html"><strong aria-hidden="true">27.</strong> Events and Messages</a></li><li class="chapter-item expanded "><a href="../events/event_propagation.html"><strong aria-hidden="true">28.</strong> Event Propagation</a></li><li class="chapter-item expanded "><a href="../events/handling_events.html"><strong aria-hidden="true">29.</strong> Handling Events</a></li><li class="chapter-item expanded "><a href="../events/window_events.html"><strong aria-hidden="true">30.</strong> Window Events</a></li><li class="chapter-item expanded affix "><li class="part-title">Binding and Reactivity</li><li class="chapter-item expanded "><a href="../binding/intro.html"><strong aria-hidden="true">31.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../binding/model.html"><strong aria-hidden="true">32.</strong> Model</a></li><li class="chapter-item expanded "><a href="../binding/lens.html"><strong aria-hidden="true">33.</strong> Lens</a></li><li class="chapter-item expanded affix "><li class="part-title">Widget Reference</li><li class="chapter-item expanded "><a href="../widgets/buttons.html"><strong aria-hidden="true">34.</strong> Buttons</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../widgets/buttons/button.html"><strong aria-hidden="true">34.1.</strong> Button</a></li><li class="chapter-item expanded "><a href="../widgets/buttons/check_button.html"><strong aria-hidden="true">34.2.</strong> CheckButton</a></li><li class="chapter-item expanded "><a href="../widgets/buttons/checkbox.html"><strong aria-hidden="true">34.3.</strong> Checkbox</a></li><li class="chapter-item expanded "><a href="../widgets/buttons/radio.html"><strong aria-hidden="true">34.4.</strong> Radio</a></li><li class="chapter-item expanded "><a href="../widgets/buttons/switch.html"><strong aria-hidden="true">34.5.</strong> Switch</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Tuix Guide</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="events"><a class="header" href="#events">Events</a></h1>
<p>Alright, we've got a nice looking counter but how do we make it do something? Time for some events!</p>
<h2 id="handling-events"><a class="header" href="#handling-events">Handling Events</a></h2>
<p>The <code>Widget</code> trait has another method called <code>on_event</code> which will allow us to react to events and change the internal data (the counter value) and child widgets (the buttons and label) of our counter. Add the following to the implementation of the <code>Widget</code> trait for our counter, right below the <code>on_build()</code> method:</p>
<pre><code class="language-rs">fn on_event(&amp;mut self, state: &amp;mut State, entity: Entity, event: &amp;mut Event) {

}
</code></pre>
<p>Note that the method signature is very similar to <code>on_build</code> but, instead of returning something, there's an extra argument, a mutable reference to some <code>Event</code>.</p>
<h2 id="messages"><a class="header" href="#messages">Messages</a></h2>
<p>So what is the event? Well an event is a struct which contains a <code>Message</code> and some meta data about the event, like its origin and target entities. Okay so what's a <code>Message</code>? Well a message is a dynamic object pointer to some user defined type. In fact it can be any type as long as it implements <code>PartialEq</code>. So let's make a message type which we can respond to. Add this just before we declare the <code>Counter</code> struct:</p>
<pre><code class="language-rs">#[derive(PartialEq)]
pub enum CounterEvent {
    Increment,
    Decrement,
}
</code></pre>
<p>Now we can modify the <code>on_event</code> method to do something when it receives this type of event:</p>
<pre><code class="language-rs">fn on_event(&amp;mut self, state: &amp;mut State, entity: Entity, event: &amp;mut Event) {
    if let Some(counter_event) = event.message.downcast() {
        match counter_event {
            CounterEvent::Increment =&gt; {
                self.value += 1;
            }

            CounterEvent::Decrement =&gt; {
                self.value -= 1;
            }
        }
    }
}

</code></pre>
<p>Here we attempt to <a href="https://bennetthardwick.com/rust/downcast-trait-object/">downcast</a> the message within the event to the <code>ConterEvent</code> type, and on success match against the options, incrementing or decrementing the counter value in response. </p>
<p>Okay, so our counter widget can now respond to counter events, but how does it get them? Something needs to send those events. How about those buttons?</p>
<h2 id="callbacks"><a class="header" href="#callbacks">Callbacks</a></h2>
<p>To send events when our buttons are pressed we need another new concept, which is callbacks. Most widgets allow you to set a callback (a closure) which will run when the widget is interacted with or changes state. In this case it's probably best to learn by example so change the decrement button to look like this:</p>
<pre><code class="language-rs">Button::with_label(&quot;Decrement&quot;)
    .on_press(|data: &amp;mut Button, state: &amp;mut State, button: Entity|{
        button.emit(state, CounterEvent::Decrement);
    })
    .build(state, row, |builder|
        builder
            .set_width(Pixels(100.0))
            .set_height(Pixels(30.0))
            .class(&quot;decrement&quot;)
    )
</code></pre>
<p>For clarity I've included the argument types but these can be inferred by the rust compiler. Notice that the arguments shadow those of <code>on_build</code> and the first 3 of <code>on_event</code>, providing a mutable reference to the widget (<code>Button</code> in this case), a mutable reference to <code>State</code>, and the <code>Entity</code> id of the button.</p>
<p>Using the button id and state we call <code>emit()</code> to send a <code>CounterEvent::Decrement</code> event. As the name suggests, this callback will be triggered when the button is pressed.</p>
<p>But where does the event go? Remember that tree which was mentioned before? Well, by default, events are sent <em>up</em> the tree, hitting every ancestor on its way to the root (the window). Because the button is a descendant of the counter (counter -&gt; row -&gt; button), the counter will receive the event after the button is pressed. The figure below depicts the tree of widgets with our custom counter widget:</p>
<p align="center"><img src="../images/quick_guide/counter_tree.png" alt="tuix app"></p>
<p>We're almost there. Adding in the callback for the increment button (left as an exercise for the reader), we now have a counter whose value will change when the buttons are pressed! Hang on though... nothing seems to be happening... the label still shows zero. Ah, we need to make two more modifications to update the label.</p>
<p>First, we need to store the entity id of the label in the counter so we can access it in <code>on_event</code>. Change the <code>Counter</code> to:</p>
<pre><code class="language-rs">#[derive(Default)]
struct Counter {
    value: i32,
    label: Entity,
}
</code></pre>
<p>and then the label to:</p>
<pre><code class="language-rs">// We now assign the output of the label build to the label variable
self.label = Label::new(&quot;0&quot;).build(state, row, |builder| 
    builder
        .set_width(Pixels(100.0))
        .set_height(Pixels(30.0))
);
</code></pre>
<p>Finally, we need to update the label text in the <code>on_event</code> method:</p>
<pre><code class="language-rs">fn on_event(&amp;mut self, state: &amp;mut State, entity: Entity, event: &amp;mut Event) {
    if let Some(counter_event) = event.message.downcast() {
        match counter_event {
            CounterEvent::Increment =&gt; {
                self.value += 1;
                self.label.set_text(state, &amp;self.value.to_string());
            }

            CounterEvent::Decrement =&gt; {
                self.value -= 1;
                self.label.set_text(state, &amp;self.value.to_string());
            }
        }
    }
}
</code></pre>
<p>We can set the label this way because every widget has a text property which can be set through its entity id. If this was a more complicated widget, such as a slider, then we would update it using an event targeted at the widget. For example, we could send a <code>SliderEvent::SetValue()</code> event to a slider widget to update it.</p>
<p>We finally have a working counter!</p>
<p>You can find the full code for this guide so far in the <code>examples/counter.rs</code> file in the tuix repository. Run with <code>cargo run --release --example counter</code>. </p>
<p align="center"><img src="../images/quick_guide/counter.png" alt="tuix app"></p>
<p>In the next section we'll start to look at how we can make our counter widget more re-usable with some reactivity.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../quick_start/custom_widget.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../quick_start/reactivity_and_binding.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../quick_start/custom_widget.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../quick_start/reactivity_and_binding.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
